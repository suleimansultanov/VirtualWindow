@using Microsoft.AspNetCore.Mvc.Localization
@using NasladdinPlace.Utilities.EnumHelpers
@inject IViewLocalizer Localizer


@model NasladdinPlace.UI.ViewModels.Security.EditAppFeaturesViewModel

@{
    ViewData["Title"] = Localizer["Title"].Value;
}
<div class="row row-eq-height wrapper border-bottom white-bg p-sm">
    <div class="col-xs-9 col-sm-10">
        <ol class="breadcrumb">
            <li class="hidden-xs">
                <a href="@Url.Action("All","PointsOfSale")">@Localizer["Home"].Value</a>
            </li>
            <li class="hidden-xs">
                <a href="@Url.Action("GetPermissions", "Security")">@Localizer["List of permissions"].Value</a>
            </li>
            <li class="active">
                <strong>@ViewData["Title"]</strong>
            </li>
        </ol>
    </div>
    <div class="col-xs-3 col-sm-2">
    </div>
</div>

<div class="wrapper wrapper-content fadeIn">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox float-e-margins">
                <div class="ibox-content" id="reference-list">
                    <div class="row">
                        <div class="col-sm-12">
                            <form id="app-features-form" class="form-horizontal" method="post" asp-action="Edit" asp-controller="Security">
                                <div>
                                    @if (Model.AvailableAppFeatures.Count == 0)
                                    {
                                        @Localizer["No permissions defined"].Value
                                    }
                                    else if (Model.AvailableRoles.Count == 0)
                                    {
                                        @Localizer["No roles available"].Value
                                    }
                                    else
                                    {
                                        <div class="scroll-wrapper">
                                            <table class="table table-hover table-bordered" summary="@Localizer["Title"].Value">
                                                <thead>
                                                    <tr>
                                                        <th scope="col">
                                                            <strong>@Localizer["Categories"].Value</strong>
                                                        </th>
                                                        <th scope="col">
                                                            <strong>@Localizer["Permissions"].Value</strong>
                                                        </th>
                                                        @foreach (var role in Model.AvailableRoles)
                                                        {
                                                            <th scope="col">
                                                                <div class="checkbox">
                                                                    <label>
                                                                        <strong>@Localizer[role.Name].Value</strong>
                                                                    </label>
                                                                </div>
                                                            </th>
                                                        }
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    @foreach (var permission in Model.AvailableAppFeatures.OrderBy(x => x.PermissionCategory.GetDescription()))
                                                    {
                                                        <tr>
                                                            <td>
                                                                <span>@permission.PermissionCategory.GetDescription()</span>
                                                            </td>
                                                            <td>
                                                                <span>@permission.Description</span>
                                                            </td>
                                                            @foreach (var role in Model.AvailableRoles)
                                                            {
                                                                var allowed = Model.Allowed.ContainsKey(permission.Name) && Model.Allowed[permission.Name][role.Id];
                                                                <td>
                                                                    <input type="checkbox" value="@(permission.Name)" name="allow_@(role.Id)" @(allowed ? " checked=checked" : null) />
                                                                </td>
                                                            }
                                                        </tr>
                                                    }
                                                </tbody>
                                            </table>
                                        </div>
                                    }
                                </div>
                                <div class="content-header clearfix">
                                    <div class="pull-left">
                                        <button type="submit" name="save" class="btn btn-primary">
                                            <em class="fa fa-floppy-o"></em>
                                            @Localizer["Save"].Value
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>